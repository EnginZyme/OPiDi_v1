<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Opentrons Protocol Generator: Opentrons Protocol Generator</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Opentrons Protocol Generator<span id="projectnumber">&#160;2.4.0</span>
   </div>
   <div id="projectbrief">Custom Protocol Generator for the Opentrons Liquid Handling Robots</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Opentrons Protocol Generator </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_README"></a> The Opentrons Protocol Generator is designed first and foremost to generate Opentrons compatible protocol files from a set of instructions designed in the Opentrons Protocol Designer App. The instructions are defined in a JSON file following a very speciffic schema. It is built with support for Opentrons API v2 and uses heavily the native <a href="https://docs.opentrons.com/v2/#">OT-2 API V2</a></p>
<p >More detailed documentation can be found at: <a href="https://enginzyme.gitlab.io/opentrons/opentrons-protocol-generator/">https://enginzyme.gitlab.io/opentrons/opentrons-protocol-generator/</a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Getting Started</h1>
<h2><a class="anchor" id="autotoc_md2"></a>
Software Architecture</h2>
<p >As can be seen below the protocol generator sits between the protocol designer and the physical Opentrons robot.</p>
<p ><img src="OPG_High_Level_Architecture.jpg" alt="" class="inline" title="High Level System Design"/></p>
<h3><a class="anchor" id="autotoc_md3"></a>
Transpiler</h3>
<p >The transpiler contains the code the Opentrons will run through when a protocol is begun. For more information on the general setup and functions available read through the <a href="https://docs.opentrons.com/v2/#">OT-2 API V2</a>.</p>
<p >It is a set of classes split across differing files. The main transpiler loop can be found in <code>opentrons_transpiler.py</code>. After initialising the required classes and Opentrons protocol context, the loop begins with a pre-protocol "flight check" whose purpose is to run a few basic tests to mitigate the risk the protocol will crash half way in, for example testing the <a href="https://www.qinstruments.com/automation/bioshake-3000-t/">BioShake 3000T</a>. Next it iterates through all the steps in the instructions file generated by the Opentrons Designer App calling them and performing their respective actions. If at any point an exception is encountered, it will be caught and sent via Slack to a debugging channel. If all goes well, the protocol will finish with a post-protocol "cleanup" step to ensure a graceful completion and log the experiment using the AWS service Cloud Watch. In the event of a failure, the protocol will still log, however add an error message.</p>
<p >For more detailed information on the transpiler, check the documentation for each class.</p>
<h3><a class="anchor" id="autotoc_md4"></a>
Generator</h3>
<p >The <code>opentrons_generator.py</code> has the simple purpose of formatting and joining the instructions file and transpiler into a protocol file that can be directly ran on the Opentrons. It acts as an interpreter converting the instructions file, designed to make generation on the JavaScript based frontend simpler, into a format the python based transpiler expects. For detailed descriptions on the exact format the generator expects, please consult the schemas outlined in <code>protocol_generator/schemas</code>.</p>
<p >The generator also has an accompanying basic command line interface (opentrons_CLI) allowing for it to be called directly from the terminal.</p>
<p ><a class="anchor" id="Simulator"></a> </p>
<h3><a class="anchor" id="autotoc_md5"></a>
Simulator</h3>
<p >There are three ways in which generated protocols can be simulate.</p><ul>
<li>Using the Command Line Interface provided by the Opentrons Python package<ul>
<li>By calling <code>opentrons_simulate</code> one can through the command line simulate any protocol.<ul>
<li><code>usage: opentrons_simulate [-h] [-l {debug,info,warning,error,none}] [-L CUSTOM_LABWARE_PATH] [-D [CUSTOM_DATA_PATH]] [-s CUSTOM_HARDWARE_SIMULATOR_FILE] [-d CUSTOM_DATA_FILE] [-v] [-o {runlog,nothing}] PROTOCOL</code></li>
</ul>
</li>
</ul>
</li>
<li>Importing the Opentrons Simulation package into a python script and calling the natve API. An example of this is provided in the opentrons_simulator.py file.</li>
<li>Running the <a href="https://opentrons.com/ot-app/">Opentrons App</a>, loading the protocol, and simulating.</li>
</ul>
<h3><a class="anchor" id="autotoc_md6"></a>
A note on Custom Labware</h3>
<p >Opentrons have a set of native labware and accompanying <a href="https://labware.opentrons.com/">Labware Library</a> containing the JSON based definitions for each piece of labware. However, there are situations where one wishes to add their own custom labware to the deck. One example of this is the use of labware mounted on a <a href="https://www.qinstruments.com/automation/bioshake-3000-t/">BioShake 3000T</a>. This repo contains a set of custom labware definitions defined for use at EnginZyme. These definitions must be provided as input to the simulation scripts and also in the Opentrons app as they must be propagated to the hardware. Alternatively one can define their own custom labware using these as examples.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Generating and testing</h2>
<p >In order to use the command line interface to generate a protocol follow these simple steps:</p><ul>
<li>Clone the Repo</li>
<li>Generate a robot instructions file using opentrons designer repo or your own tool</li>
<li>Call the <code>opentrons_cli.py</code> script passing the name of instructions file as input and the name of the desired protocol as output. Note that the default location for reading instructions is <code>test/instructions</code> and the default location for storing protocols is <code>test/protocols</code>.</li>
<li>Simulate the protocol using one of the methods described above in the <a href="#Simulator">simulator section</a></li>
<li>If Simulation passes, run the protocol on the Opentrons hardware</li>
</ul>
<p >Alternatively run the <code>run_test.py</code> script providing an argument for the name of the instructions file to automatically generate and simulate a protocol of the same name stored in <code>test/protocols</code>.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Contributing</h1>
<p >Clone the repo and install all requirements: </p><pre class="fragment">pip3 install -r requirements.txt
</pre><p> It can be useful to also have the Opentrons App installed for the simulation and testing packages on a physical Opentrons. The App Image can be found at: <a href="https://opentrons.com/ot-app/">https://opentrons.com/ot-app/</a></p>
<p >Documentation has been generated using <a href="https://www.doxygen.nl/download.html">Doxygen</a> and can be run: doxygen Doxyfile</p>
<p >Repo has been Formatted according to google style guide using <a href="https://github.com/google/yapf">YAPF</a> yapf . &ndash;style google -i -r And spell-checked using <a href="https://facelessuser.github.io/pyspelling/">pyspelling</a> pyspelling</p>
<h1><a class="anchor" id="autotoc_md9"></a>
AWS Configuration</h1>
<p >TODO: Decide how exactly we write this part of the ReadMe .. i..e flask app etc.. .</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Linux Users</h2>
<p >Follow the guide <a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html">here</a> to download the AWS CLI tool.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Windows Users</h2>
<p >Follow the guide <a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-windows.html">here</a> to download the AWS CLI tool.</p>
<p >Next, run the following command in your terminal (and fill in your details appropriately)</p>
<div class="fragment"><div class="line">$ aws configure</div>
</div><!-- fragment --><div class="fragment"><div class="line">AWS Access Key ID [None]: &lt;your-access-key&gt;</div>
<div class="line">AWS Secret Access Key [None]: &lt;your-access-key&gt;</div>
<div class="line">Default region name [None]: eu-north-1</div>
<div class="line">Default output format [None]: json</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md12"></a>
Elastic Beanstalk Configuration</h1>
<h2><a class="anchor" id="autotoc_md13"></a>
Linux Users</h2>
<p >Follow the guide <a href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb-cli3-install-linux.html">here</a> to download the EB CLI tool.</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Windows Users</h2>
<p >Follow the guide <a href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb-cli3-install-windows.html">here</a> to download the EB CLI tool.</p>
<h1><a class="anchor" id="autotoc_md15"></a>
Opentrons Protocol Generator</h1>
<h2><a class="anchor" id="autotoc_md16"></a>
Custom EB Configuration</h2>
<p >**_N.B_**_:_ <em>Please, carry out the steps in the Elastic Beanstalk Configuration section before proceeding.</em></p>
<p >Kindly run the following command and fill in 18 (for Stockholm) at the prompt</p>
<div class="fragment"><div class="line">$ eb init</div>
<div class="line">Select a default region</div>
<div class="line">1) us-east-1 : US East (N. Virginia)</div>
<div class="line">2) us-west-1 : US West (N. California)</div>
<div class="line">3) us-west-2 : US West (Oregon)</div>
<div class="line">4) eu-west-1 : Europe (Ireland)</div>
<div class="line">5) eu-central-1 : Europe (Frankfurt)</div>
<div class="line">6) ap-south-1 : Asia Pacific (Mumbai)</div>
<div class="line">7) ap-southeast-1 : Asia Pacific (Singapore)</div>
<div class="line">...</div>
<div class="line">(default is 3): 18</div>
</div><!-- fragment --><p >Next, fill in your details appropriately at the prompt</p>
<div class="fragment"><div class="line">You have not yet set up your credentials or your credentials are incorrect.</div>
<div class="line">You must provide your credentials.</div>
<div class="line">(aws-access-id): &lt;your-aws-access-id&gt;</div>
<div class="line">(aws-secret-key): &lt;your-aws-secret-key&gt;</div>
</div><!-- fragment --><p >Next, fill in 1 (for opentrons-protocol-generator) at the prompt</p>
<div class="fragment"><div class="line">Select an application to use</div>
<div class="line">1) opentrons-protocol-generator</div>
<div class="line">2) clarity_server</div>
<div class="line">3) protocol-objects-api</div>
<div class="line">4) [ Create new Application ]</div>
<div class="line">(default is 4): 1</div>
</div><!-- fragment --><p >Next, fill in 2 (for protocol-generator-private-env) at the prompt</p>
<div class="fragment"><div class="line">Select the default environment.</div>
<div class="line">You can change this later by typing &quot;eb use [environment_name]&quot;.</div>
<div class="line">1) protocol-generator-private-dev-env</div>
<div class="line">2) protocol-generator-private-env</div>
<div class="line">(default is 1): 2</div>
</div><!-- fragment --><p >Next, fill in "n" (for No) at the prompt</p>
<div class="fragment"><div class="line">Do you wish to continue with CodeCommit? (Y/n): n</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md17"></a>
Development Server Update</h2>
<p >Assuming that you have cloned the <a href="https://gitlab.com/enginzyme/opentrons-protocol-generator">Gitlab repository</a> for the <a href="http://opentrons-protocol-generator-dev.eu-north-1.elasticbeanstalk.com/">project</a> (and pushed or merged your changes into the master branch), run the following set of commands in your terminal window (in the root directory of the project)</p>
<div class="fragment"><div class="line">$ eb use protocol-generator-private-dev-env</div>
<div class="line">$ git checkout develop</div>
<div class="line">$ git pull</div>
<div class="line">$ eb deploy</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md18"></a>
autotoc_md18</h2>
<h2><a class="anchor" id="autotoc_md19"></a>
Production Server Update</h2>
<p >Assuming that you have cloned the <a href="https://gitlab.com/enginzyme/opentrons-protocol-generator">Gitlab repository</a> for the <a href="http://opentrons-protocol-generator.eu-north-1.elasticbeanstalk.com/">project</a> (and pushed or merged your changes into the master branch), run the following set of commands in your terminal window (in the root directory of the project)</p>
<div class="fragment"><div class="line">$ eb use protocol-generator-private-env</div>
<div class="line">$ git checkout master</div>
<div class="line">$ git pull</div>
<div class="line">$ eb deploy</div>
</div><!-- fragment --><hr  />
 </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
